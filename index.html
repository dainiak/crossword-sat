<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matrix Display</title>
    <style>
        table {
            border-collapse: collapse;
            border-spacing: 0;
            margin: auto;
        }

        td.custom-td {
            width: 30px;
            height: 30px;
            border: 1px solid #ddd;
            text-align: center;
            vertical-align: middle;
            font-family: Candara, sans-serif;
            font-size: 20px;
            padding: 0;
            box-sizing: border-box;
            position: relative;
            overflow: visible;
        }

        td div {
            position: absolute;
            width: 28px;
            height: 28px;
            top: 0;
            left: 0;
            overflow: visible;
        }

        .hint {
            cursor: pointer;
            user-select: none;
        }

        .highlight {
            background-color: #ffdd59;
        }

        .cell-number {
            position: absolute;
            top: -3px;
            left: 1px;
            height: 15px;
            width: 20px;
            font-size: 12px;
            overflow: visible;
            vertical-align: top;
            text-align: left;
            margin: 0;
            padding: 0;
            color: #333;
            font-family:   Arial, sans-serif;
        }

        .cell-arrow {
            position: absolute;
        }

        .left-to-right-arrow {
            transform: scale(1.2) translate(-35%, -12%);
        }

        .top-to-bottom-arrow {
            transform: scale(1.2) translate(-95%,30%);
        }
    </style>
</head>
<body>

<div class="container mt-3">
    <div class="row">
        <div class="col">
            <table class="square-table">
                <tbody id="matrix-table"></tbody>
            </table>
        </div>
        <div class="col">
            <div id="hints">
                <p>Down:</p>
                <ol id="hintsDown"></ol>
                <p>Across:</p>
                <ol id="hintsAcross"></ol>
            </div>
        </div>
    </div>
</div>

<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>
<script src="output/output.js"></script>

<script>
    const matrix = [];
    const x_bound = 20;
    const y_bound = 20;
    for(let i = 0; i < y_bound; i++) {
        matrix.push(new Array(x_bound));
    }

    for(let i = 0; i < y_bound; i++)
        for(let j = 0; j < x_bound; j++)
            matrix[i][j] = '';

    const across = new Map();
    const down = new Map();
    const cellNumbers = new Map();

    let counter = 0;

    placement_data.forEach((placement) => {
        let x = placement.x;
        let y = placement.y;
        let word = placement.word;
        for(let i = 0; i < word.length; i++) {
            matrix[y][x] = word[i];
            if(placement.horizontal) {
                x++;
            } else {
                y++;
            }
        }

        const cellKey = `${placement.x},${placement.y}`;
        if(!cellNumbers.has(cellKey))
            cellNumbers.set(cellKey, ++counter);
        placement.cellNumber = cellNumbers.get(cellKey);
        (placement.horizontal ? across : down).set(cellKey, placement);
    });

    function generateTable(matrix) {
        const tableBody = document.getElementById('matrix-table');
        tableBody.innerHTML = '';

        matrix.forEach((row, rowIndex) => {
            let tr = document.createElement('tr');
            row.forEach((cell, cellIndex) => {
                let td = document.createElement('td');
                td.classList.add('custom-td');

                let tdDiv = document.createElement('div');
                let leftToRightArrowHTML = "<svg class=\"cell-arrow left-to-right-arrow\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\">\n" +
                    "<path d=\"M0,10 L15,10 M10,5 L15,10 L10,15\" /></svg>";
                let topToBottomArrowHTML = "<svg class=\"cell-arrow top-to-bottom-arrow\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\">\n" +
                    "<path d=\"M10,0 L10,15 M5,10 L10,15 L15,10\" /></svg>";

                let cellNumber = cellNumbers.get(`${cellIndex},${rowIndex}`);
                if(cellNumber) {
                    tdDiv.innerHTML += "<div class=\"cell-number\">" + cellNumber + "</div>";
                }
                if(across.has(`${cellIndex},${rowIndex}`)) {
                    tdDiv.innerHTML += leftToRightArrowHTML;
                }
                if(down.has(`${cellIndex},${rowIndex}`)) {
                    tdDiv.innerHTML += topToBottomArrowHTML;
                }
                tdDiv.appendChild(document.createTextNode(cell));
                td.appendChild(tdDiv);
                td.dataset.row = rowIndex;
                td.dataset.col = cellIndex;
                tr.appendChild(td);
            });
            tableBody.appendChild(tr);
        });
    }

    function displayHints() {
        const hintsAcross = document.getElementById('hintsAcross');
        const hintsDown = document.getElementById('hintsDown');
        console.log(cellNumbers);

        placement_data.forEach((placement, placementIndex) => {
            let li = document.createElement('li');
            const placementKey = `${placement.x},${placement.y}`;
            li.value = cellNumbers.get(placementKey);
            console.log(li.value);
            li.textContent = placement.hint;
            li.classList.add('hint');
            const placementToHightlight = placementIndex;
            li.onclick = function () {
                highlightWord(placementToHightlight);
            };
            (placement.horizontal ? hintsAcross : hintsDown).appendChild(li);
        });
    }

    function highlightWord(placementIndex) {
        document.querySelectorAll('.highlight').forEach(cell => {
            cell.classList.remove('highlight');
        });

        const placement = placement_data[placementIndex];
        let x = placement.x;
        let y = placement.y;
        for (let i = 0; i < placement.word.length; i++) {
            let cell = document.querySelector(`td[data-row="${y}"][data-col="${x}"]`);
            if (placement.horizontal) {
                x++;
            } else {
                y++;
            }
            cell.classList.add('highlight');
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        generateTable(matrix);
        displayHints();
    });
</script>
</body>
</html>
